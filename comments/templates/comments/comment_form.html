{% load static %}
{% load comment_tags %}

{% generate_form_for post as form %}


<form id="submit_comment" method="post" action="{% url 'comments:submit_comment' post.id %}">

    <textarea name="submit" placeholder="è¯´å‡ºä½ å¤§èƒ†çš„æƒ³æ³•..." id="comment_text_area"
              required></textarea>

    <button id="comment_button" class="button button-3d button-primary button-rounded" type="button">è¯„è®º</button>
    <button id="cancel_button" style="display:none" class="button button-3d button-caution button-rounded"
            type="button" onclick="cancel_reply()">å–æ¶ˆ
    </button>
    <div id="code-1" style="display: none;"></div>
    <a class="button button-primary button-box button-small" href="javascript:exec(1);">å¸®åŠ©</a>
    <span id="emojihere" style="cursor: pointer;"><a style="font-size:2.0em" id='faceEnter'
                                                     onclick='showFaceBlock()'>ğŸ˜ƒ</a></span>
</form>
<hr>
<script>
    var parentId = '';

    function cancel_reply() {
        $('textarea').attr('placeholder', 'è¯´å‡ºä½ å¤§èƒ†çš„æƒ³æ³•...');
        document.getElementById('cancel_button').style.display = 'none';
        document.getElementById('comment_text_area').value = '';
        parentId = '';
    }

    $(document).ready(function () {
        /*ä½¿è¯„è®ºæ¡†å®é™…å®½åº¦å®½åº¦ä¸...ä¸€è‡´*/
        /*åœ¨jquery.emojiFace.jsé‡Œæ›´æ”¹*/
        var wwidth = document.getElementsByClassName('col-md-8')[0].offsetWidth - 40;
        document.getElementById('comment_text_area').style.width = wwidth + 'px';

        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'}
        });
        document.getElementById('comment_button').onclick = function () {
            var content = document.getElementById('comment_text_area').value;
            if (content.length == 0) {
                exec(2);
                return;
            }
            var request = $.ajax({
                type: 'POST',
                url: "{% url 'comments:submit_comment' post.id %}",
                dataType: "json",
                async: true,
                timeout: 10000,
                data: {
                    'honeypot': '',
                    'content': '<fuck>\n' +
                    '\n' + content,
                    'parent': parentId,
                    'post':{{ post.id }}
                },
                success: function () {
                    window.location.reload();
                },
                complete: function (XMLHttpRequest, status) {
                    if (status == 'timeout') {
                        request.abort();    // è¶…æ—¶åä¸­æ–­è¯·æ±‚
                        alert('è¯·æ±‚è¶…æ—¶');
                    }
                },
                error: function () {
                    alert("ğŸ˜«å‡ºé”™äº†ğŸ˜«,å¯ä»¥å‘é‚®ç®± 1773741250@qq.com å‘é€åé¦ˆ");
                }
            });
        }
    })
</script>